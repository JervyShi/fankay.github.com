<?xml version="1.0" encoding="utf-8"?>
  <rss version="2.0"
        xmlns:content="http://purl.org/rss/1.0/modules/content/"
        xmlns:atom="http://www.w3.org/2005/Atom"
  >
  <channel>
    <title>樊凯</title>
    <link href="http://fankai.me/feed/" rel="self" />
    <link href="http://yihui.name/" />
    <lastBuildDate>2012-04-18T11:11:01+08:00</lastBuildDate>
    <webMaster>fankai@kaishengit.com</webMaster>
    
    <item>
      <title>回归简约</title>
      <link href="http://fankai.me/2012/04/jianyue/"/>
      <pubDate>2012-04-18T11:01:00+08:00</pubDate>
      <author>樊凯</author>
      <guid>http://fankai.me/2012/04/jianyue</guid>
      <content:encoded><![CDATA[<p>重新把Blog设置为原生的Jekyll了，不在使用<a href='http://www.octopress.org'>Octopress</a>和<a href='http://jekyllbootstrap.com/'>jekyllbootstrap</a>这些Jekyll的衍生版了。原因很简单，虽然使用这些衍生版让你觉得很简单，但是也失去了深入了解Jekyll的机会。还有一个原因，喜欢Jekyll这套主题，很简约和实用。</p>]]></content:encoded>
    </item>
    
    <item>
      <title>光明与磊落</title>
      <link href="http://fankai.me/2012/04/guangmingyuleiluo/"/>
      <pubDate>2012-04-18T10:05:00+08:00</pubDate>
      <author>樊凯</author>
      <guid>http://fankai.me/2012/04/guangmingyuleiluo</guid>
      <content:encoded><![CDATA[<p><img alt='光明与磊落' src='http://ww1.sinaimg.cn/mw600/62772de6jw1ds3k8zf4suj.jpg' /><br />在京东上购买的书到了，￥9.9很是超值！</p>]]></content:encoded>
    </item>
    
    <item>
      <title>在Java中使用Gravatar头像服务</title>
      <link href="http://fankai.me/2012/04/use-gravator-in-java/"/>
      <pubDate>2012-04-15T11:07:00+08:00</pubDate>
      <author>樊凯</author>
      <guid>http://fankai.me/2012/04/use-gravator-in-java</guid>
      <content:encoded><![CDATA[<p><a href='http://en.gravatar.com/'>Gravatar</a>是一个从事全球头像服务的网站，其实也就是根据你注册的电子邮件地址来绑定一个头像(当然需要你自己上传)。当你在一个支持Gravatar服务的网站上使用你的电子邮件地址作为注册的邮箱是，该网站就可以自动读取到你在Gravatar网站是设置的头像并显示。这样就保证了你一个头像，全网通用了。对于开发者来说也不需要开发头像上传服务了。只需要让用户在<a href='http://en.gravatar.com'>Gravator</a>上进行设置即可。</p>

<p>在Java的Web项目中使用Gravator也是非常简单的，方式有两种：</p>

<h4 id='1'>方法1：自己动手</h4>

<ul>
<li>创建<a href='http://en.gravatar.com/site/implement/images/java/'>MD5Util</a>类</li>
</ul>
<div class='highlight'><pre><code class='java'><span class='kd'>public</span> <span class='kd'>class</span> <span class='nc'>MD5Util</span> <span class='o'>{</span>
  <span class='kd'>public</span> <span class='kd'>static</span> <span class='n'>String</span> <span class='nf'>hex</span><span class='o'>(</span><span class='kt'>byte</span><span class='o'>[]</span> <span class='n'>array</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>StringBuffer</span> <span class='n'>sb</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>StringBuffer</span><span class='o'>();</span>
      <span class='k'>for</span> <span class='o'>(</span><span class='kt'>int</span> <span class='n'>i</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span> <span class='n'>i</span> <span class='o'>&lt;</span> <span class='n'>array</span><span class='o'>.</span><span class='na'>length</span><span class='o'>;</span> <span class='o'>++</span><span class='n'>i</span><span class='o'>)</span> <span class='o'>{</span>
	  <span class='n'>sb</span><span class='o'>.</span><span class='na'>append</span><span class='o'>(</span><span class='n'>Integer</span><span class='o'>.</span><span class='na'>toHexString</span><span class='o'>((</span><span class='n'>array</span><span class='o'>[</span><span class='n'>i</span><span class='o'>]</span>
	      <span class='o'>&amp;</span> <span class='mi'>0</span><span class='n'>xFF</span><span class='o'>)</span> <span class='o'>|</span> <span class='mh'>0x100</span><span class='o'>).</span><span class='na'>substring</span><span class='o'>(</span><span class='mi'>1</span><span class='o'>,</span><span class='mi'>3</span><span class='o'>));</span>        
      <span class='o'>}</span>
      <span class='k'>return</span> <span class='n'>sb</span><span class='o'>.</span><span class='na'>toString</span><span class='o'>();</span>
  <span class='o'>}</span>
  <span class='kd'>public</span> <span class='kd'>static</span> <span class='n'>String</span> <span class='nf'>md5Hex</span> <span class='o'>(</span><span class='n'>String</span> <span class='n'>message</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>try</span> <span class='o'>{</span>
	  <span class='n'>MessageDigest</span> <span class='n'>md</span> <span class='o'>=</span> 
	      <span class='n'>MessageDigest</span><span class='o'>.</span><span class='na'>getInstance</span><span class='o'>(</span><span class='s'>&quot;MD5&quot;</span><span class='o'>);</span>
	  <span class='k'>return</span> <span class='nf'>hex</span> <span class='o'>(</span><span class='n'>md</span><span class='o'>.</span><span class='na'>digest</span><span class='o'>(</span><span class='n'>message</span><span class='o'>.</span><span class='na'>getBytes</span><span class='o'>(</span><span class='s'>&quot;CP1252&quot;</span><span class='o'>)));</span>
      <span class='o'>}</span> <span class='k'>catch</span> <span class='o'>(</span><span class='n'>NoSuchAlgorithmException</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='o'>}</span> <span class='k'>catch</span> <span class='o'>(</span><span class='n'>UnsupportedEncodingException</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='o'>}</span>
      <span class='k'>return</span> <span class='kc'>null</span><span class='o'>;</span>
  <span class='o'>}</span>
<span class='o'>}</span>
</code></pre>
</div>
<ul>
<li>使用MD5Util类获取电子邮件的hex码</li>
</ul>

<p><div class='highlight'><pre><code class='java'><span class='n'>String</span> <span class='n'>result</span> <span class='o'>=</span> <span class='n'>MD5Util</span><span class='o'>.</span><span class='na'>md5Hex</span><span class='o'>(</span><span class='s'>&quot;fankai@kaishengit.com&quot;</span><span class='o'>);</span>
</code></pre>
</div></p>

<p>这样就获取了该电子邮件对应的hex编码，将该编码传入的到http://www.gravatar.com/avatar/链接后就可以获取该邮件对应的图片了。例如上述邮件的hex码为8266241e1c2c5460924cf1a512190d2c，那么最终的图片地址就是http://www.gravatar.com/avatar/8266241e1c2c5460924cf1a512190d2c，显示如下：<br /><img alt='我的头像' src='http://www.gravatar.com/avatar/8266241e1c2c5460924cf1a512190d2c' /></p>

<p>如果该电子邮件未在Gravatar网站上进行注册，则会返回一个默认图片，如下：<br /><img alt='默认头像' src='http://www.gravatar.com/avatar/8266241e1c2c5460924cf1a51xxx' /></p>

<h4 id='2jgavatar'>方法2：使用JGavatar项目</h4>

<p><a href='https://github.com/ralfebert/jgravatar'>jgavatar</a>提供了一系列的API让我们更方便的使用Gravatar的服务，可以到<a href='https://github.com/ralfebert/jgravatar'>Github</a>上下载。</p>]]></content:encoded>
    </item>
    
    <item>
      <title>使用Dropbox分享文件</title>
      <link href="http://fankai.me/2012/04/dropbox-share-image/"/>
      <pubDate>2012-04-10T16:51:00+08:00</pubDate>
      <author>樊凯</author>
      <guid>http://fankai.me/2012/04/dropbox-share-image</guid>
      <content:encoded><![CDATA[<p><a href='https://www.dropbox.com/referrals/NTUyNDE1Mzc3OQ?src=referrals_twitter9'>DropBox</a>中默认提供了一个名字叫做Public的文件夹，可以利用这个文件来分享这个文件，例如在个人博客中插入图片。</p>

<p>现在在博客中插入图片要么利用博客的文件上传功能，要么利用第三方的图片网站，但是不少的图片网站对外链的政策是要么收费，要么禁止外链。当前在国内用的比较多的就是新浪微博提供的相册服务，至少当前新浪并没有禁止外链。例如你现在看到下面的这张图片就来自新浪微博的相册：</p>

<p><img alt='新浪微博相册中的图片' src='http://ww4.sinaimg.cn/mw600/62772de6jw1drunc37pr3j.jpg' /></p>
<!-- more -->
<p>除了新浪微博的相册服务，还可以选择Dropbox的Public文件夹来做这样的服务，将一张图片放到Dropbox的Public文件夹中，然后右键该文件，可以获取到该文件的外链地址，格式为： <a href='http://dl.dropbox.com/u/52415377/it.png'>http://dl.dropbox.com/u/52415377/it.png</a>,不出意外的话你点击此超链接不会看到任何图片，因为GFW已经将Dropbox进行认证。那么如何搞定呢，方法有如下两种：</p>

<h4 id='https'>使用https协议即可</h4>

<p>将上面的图片连接由http改为https，<a href='https://dl.dropbox.com/u/52415377/it.png'>https://dl.dropbox.com/u/52415377/it.png</a>。下面的图片就来自我的Dropbox：<br /><img alt='Dropbox相片' src='https://dl.dropbox.com/u/52415377/it.png' /></p>

<h5 id='cname'>使用自己域名的CNAME功能</h5>

<p>在域名的控制面板中，添加一个CNAME，值为dl,将其指向dl.dropbox.com，例如配置我的域名为dl.fankai.me,这样就可以突破GFW，在不适用https协议的情况下来访问Dropbox中的图片。格式为<a href='http://dl.fankai.me/u/52415377/it.png'>http://dl.fankai.me/u/52415377/it.png</a>,其中52415377为你个人账号的ID，每人是不一样的，下面的图片来自CNAME后的显示： <img alt='CNAME后的图片' src='http://dl.fankai.me/u/52415377/it.png' /></p>

<p>使用CNAME后如果在配上<a href='https://www.cloudflare.com'>https://www.cloudflare.com</a>的免费CDN服务，显示图片的速度将加快很多！</p>]]></content:encoded>
    </item>
    
    <item>
      <title>一个准Java开发工程师应该读的书单</title>
      <link href="http://fankai.me/2012/03/dev-book/"/>
      <pubDate>2012-03-31T20:43:00+08:00</pubDate>
      <author>樊凯</author>
      <guid>http://fankai.me/2012/03/dev-book</guid>
      <content:encoded><![CDATA[<p>不少同学都会在不同阶段问我该读哪些图书来提高自己的技术，我就列个书单，供大家参考。</p>

<h3 id='java'>java基础</h3>

<ul>
<li><a href='http://book.douban.com/subject/4496038/'>Head First Java 第二版</a></li>

<li><a href='http://book.douban.com/subject/1781451/'>Java核心技术卷1</a></li>

<li><a href='http://book.douban.com/subject/3360866/'>Java核心技术卷2</a></li>
</ul>

<h3 id='sql'>SQL</h3>

<ul>
<li><a href='http://book.douban.com/subject/3719052/'>Head First SQL</a></li>

<li><a href='http://book.douban.com/subject/2124377/'>SQL必知必会</a></li>

<li><a href='http://book.douban.com/subject/3354490/'>MySQL必知必会</a></li>
</ul>

<h3 id='htmlcss'>HTML&amp;&amp;CSS</h3>

<ul>
<li><a href='http://book.douban.com/subject/3040870/'>Head First HTML CSS和XHTML</a></li>

<li><a href='http://book.douban.com/subject/5402708/'>HTML5高级程序设计</a></li>

<li><a href='http://book.douban.com/subject/1898098/'>精通CSS:高级Web标准解决方案</a></li>

<li><a href='http://book.douban.com/subject/2208550/'>CSS实战手册</a></li>

<li><a href='http://book.douban.com/subject/2052176/'>CSS禅意花园</a></li>
</ul>
<!-- more -->
<h3 id='javascript'>JavaScript</h3>

<ul>
<li><a href='http://book.douban.com/subject/2372267/'>Head First JavaScript</a></li>

<li><a href='http://book.douban.com/subject/10546125/'>JavaScript高级程序设计（第3版)</a></li>

<li><a href='http://book.douban.com/subject/2228378/'>JavaScript权威指南</a></li>

<li><a href='http://book.douban.com/subject/6688828/'>Head First JQuery</a></li>

<li><a href='http://book.douban.com/subject/4111399/'>JQuery基础教程</a></li>
</ul>

<h3 id='jspservlet'>JSP/Servlet</h3>

<ul>
<li><a href='http://book.douban.com/subject/1942934/'>Head First Jsp/Servlet</a></li>
</ul>

<h3 id='struts2_hibernate_spring'>Struts2 Hibernate Spring</h3>

<ul>
<li><a href='http://book.douban.com/subject/3005866/'>Struts2 in Action</a></li>

<li><a href='http://book.douban.com/subject/1315047/'>深入浅出Hibernate</a> 讲解的Hibernate版本虽然老了些，但是写的真的非常帮</li>

<li><a href='http://book.douban.com/subject/3208666/'>Spring in Action</a></li>
</ul>

<h3 id='linux'>Linux</h3>

<ul>
<li><a href='http://book.douban.com/subject/4889838/'>鸟哥的Linux私房菜.基础学习篇（第三版）</a></li>
</ul>

<h3 id='id8'>其他</h3>

<ul>
<li><a href='http://book.douban.com/subject/4262627/'>重构</a></li>

<li><a href='http://book.douban.com/subject/2243615/'>Head First 设计模式</a></li>

<li><a href='http://book.douban.com/subject/2208626/'>代码大全2</a></li>
</ul>

<p>其实书不在多，而在读精！</p>]]></content:encoded>
    </item>
    
    <item>
      <title>使用DropBox和DropPages搭建个人网站</title>
      <link href="http://fankai.me/2012/03/dropboxpages/"/>
      <pubDate>2012-03-31T20:22:00+08:00</pubDate>
      <author>樊凯</author>
      <guid>http://fankai.me/2012/03/dropboxpages</guid>
      <content:encoded><![CDATA[<h3 id='id6'>简介</h3>

<p>Dropbox是一个出色的文件存储和分享服务,可以帮你在电脑之间同步文件，把重要的文件备份到云端，甚至可以充当一个版本控制工具。Droppages是把Dropbox作为一个轻量级内容管理系统的工具。你只需在Dropbox里创建一个文件夹，然后分享给Droppages，这样很快你就能通过文本文件和文件夹搭起一个网站。你甚至还可以通过CSS和简单的模板设计自定义网站的界面。 Droppages非常适合搭建轻量级网站，速度非常快，无需FTP或登录信息。更牛的是它使用Dropbox对网站内容进行备份，如果你觉得网站出问题了，可以很快回滚到之前的版本。 此外，由于Dropbox已经整合到了数百个应用里面，所以你可以在这些应用里随时编辑你的网站。 <!-- more --></p>

<h3 id='id7'>使用步骤</h3>

<ul>
<li>点击此<a href='https://www.dropbox.com/referrals/NTUyNDE1Mzc3OQ?src=referrals_twitter9'>链接</a>注册一个dropbox账户，并且安装操作系统对应的Dropbox客户端。</li>

<li>从<a href='http://droppages.com/'>droppages</a>网站上下载一个示例的压缩包，并解压到Dropbox的文件夹中。将该文件夹改名为xxx.droppages.com，其中xxx为你自定义的二级站点名称。</li>

<li>将该文件夹分享给server1@droppages.com</li>

<li>这时只需要等待邮件通知吧，收到开通邮件时，你的xxx.droppages.com就可以访问了！</li>
</ul>

<p>我的测试<a href='http://fankai.droppages.com/'>droppages</a></p>]]></content:encoded>
    </item>
    
    <item>
      <title>Struts2 Interceptor(拦截器)备忘</title>
      <link href="http://fankai.me/2012/03/struts2-interceptor/"/>
      <pubDate>2012-03-19T11:17:00+08:00</pubDate>
      <author>樊凯</author>
      <guid>http://fankai.me/2012/03/struts2-interceptor</guid>
      <content:encoded><![CDATA[<blockquote>
<p>这个不是给初学struts2的同学看的，至少你需要掌握Action概念及Struts2的基本配置，以及了解什么是拦截器</p>
</blockquote>

<h3 id='struts2'>Struts2中拦截器的分类</h3>

<ul>
<li>普通拦截器，需要实现<strong>com.opensymphony.xwork2.interceptor.Interceptor</strong>接口</li>
</ul>
<div class='highlight'><pre><code class='java'><span class='kn'>import</span> <span class='nn'>com.opensymphony.xwork2.ActionInvocation</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>com.opensymphony.xwork2.interceptor.Interceptor</span><span class='o'>;</span>

<span class='kd'>public</span> <span class='kd'>class</span> <span class='nc'>LoginInterceptor</span> <span class='kd'>implements</span> <span class='n'>Interceptor</span><span class='o'>{</span>

	<span class='kd'>private</span> <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>long</span> <span class='n'>serialVersionUID</span> <span class='o'>=</span> <span class='mi'>1L</span><span class='o'>;</span>

	<span class='kd'>public</span> <span class='kt'>void</span> <span class='nf'>destroy</span><span class='o'>()</span> <span class='o'>{</span>
		
	<span class='o'>}</span>

	<span class='kd'>public</span> <span class='kt'>void</span> <span class='nf'>init</span><span class='o'>()</span> <span class='o'>{</span>
		
	<span class='o'>}</span>

	<span class='kd'>public</span> <span class='n'>String</span> <span class='nf'>intercept</span><span class='o'>(</span><span class='n'>ActionInvocation</span> <span class='n'>invocation</span><span class='o'>)</span> <span class='kd'>throws</span> <span class='n'>Exception</span> <span class='o'>{</span>
		<span class='k'>return</span> <span class='kc'>null</span><span class='o'>;</span>
	<span class='o'>}</span>
<span class='o'>}</span>
</code></pre>
</div><!-- more -->
<p>其中<strong>init</strong>方法用于拦截器进行初始化操作时调用，<strong>destroy</strong>方法用于拦截器销毁时调用，<strong>intercept</strong>方法则是拦截器的核心方法。<br />在大部分的情况下，我们不需要实现<strong>init</strong>方法以及<strong>destroy</strong>方法，那么此时只需要让拦截器类继承自<strong>com.opensymphony.xwork2.interceptor.AbstractInterceptor</strong>类，该类使用适配器模式对<strong>init</strong>方法和<strong>destroy</strong>方法进行了空实现，具体可以查看该类的源代码。</p>
<div class='highlight'><pre><code class='java'><span class='kn'>import</span> <span class='nn'>com.opensymphony.xwork2.ActionInvocation</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>com.opensymphony.xwork2.interceptor.AbstractInterceptor</span><span class='o'>;</span>

<span class='kd'>public</span> <span class='kd'>class</span> <span class='nc'>LoginInterceptor</span> <span class='kd'>extends</span> <span class='n'>AbstractInterceptor</span><span class='o'>{</span>

	<span class='kd'>private</span> <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>long</span> <span class='n'>serialVersionUID</span> <span class='o'>=</span> <span class='mi'>1L</span><span class='o'>;</span>

	<span class='nd'>@Override</span>
	<span class='kd'>public</span> <span class='n'>String</span> <span class='nf'>intercept</span><span class='o'>(</span><span class='n'>ActionInvocation</span> <span class='n'>invocation</span><span class='o'>)</span> <span class='kd'>throws</span> <span class='n'>Exception</span> <span class='o'>{</span>
		<span class='k'>return</span> <span class='kc'>null</span><span class='o'>;</span>
	<span class='o'>}</span>
<span class='o'>}</span>
</code></pre>
</div>
<p>* 方法拦截器<br />普通的拦截器对一个<em>Action</em>中所有的业务方法都会进行拦截，如果我们需要仅对<em>Action</em>中某些方法进行拦截，或者说某些方法排除在拦截范围之外，此时就需要让自己的拦截器继承自<strong>com.opensymphony.xwork2.interceptor.MethodFilterInterceptor</strong>这个抽象类</p>
<div class='highlight'><pre><code class='java'>  
<span class='kn'>import</span> <span class='nn'>com.opensymphony.xwork2.ActionInvocation</span><span class='o'>;</span>
<span class='kn'>import</span> <span class='nn'>com.opensymphony.xwork2.interceptor.MethodFilterInterceptor</span><span class='o'>;</span>

<span class='kd'>public</span> <span class='kd'>class</span> <span class='nc'>LoginInterceptor</span> <span class='kd'>extends</span> <span class='n'>MethodFilterInterceptor</span><span class='o'>{</span>

	<span class='kd'>private</span> <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>long</span> <span class='n'>serialVersionUID</span> <span class='o'>=</span> <span class='mi'>1L</span><span class='o'>;</span>

	<span class='nd'>@Override</span>
	<span class='kd'>protected</span> <span class='n'>String</span> <span class='nf'>doIntercept</span><span class='o'>(</span><span class='n'>ActionInvocation</span> <span class='n'>invocation</span><span class='o'>)</span> <span class='kd'>throws</span> <span class='n'>Exception</span> <span class='o'>{</span>
		<span class='k'>return</span> <span class='kc'>null</span><span class='o'>;</span>
	<span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>方法拦截器中核心方法就是<strong>doIntercept</strong>方法，在该方法中去实现拦截器的业务逻辑代码。方法拦截器需要在使用时通过配置文件来实现哪些方法拦截哪些方法不拦截。</p>
<div class='highlight'><pre><code class='xml'><span class='nt'>&lt;interceptor-ref</span> <span class='na'>name=</span><span class='s'>&quot;loginInterceptor&quot;</span><span class='nt'>&gt;</span>
	<span class='nt'>&lt;param</span> <span class='na'>name=</span><span class='s'>&quot;excludeMethods&quot;</span><span class='nt'>&gt;</span>execute<span class='nt'>&lt;/param&gt;</span>
	<span class='nt'>&lt;param</span> <span class='na'>name=</span><span class='s'>&quot;includeMethods&quot;</span><span class='nt'>&gt;</span>login<span class='nt'>&lt;/param&gt;</span>
<span class='nt'>&lt;/interceptor-ref&gt;</span>
</code></pre>
</div>
<p><strong>excludeMethods</strong>属性用来声明哪些方法不被拦截，<strong>includeMethod</strong>属性用来声明哪些方法被拦截，多个方法之间使用英文的逗号进行分割。</p>

<h3 id='id1'>拦截器的配置</h3>
<div class='highlight'><pre><code class='xml'><span class='nt'>&lt;package</span> <span class='na'>name=</span><span class='s'>&quot;mystruts&quot;</span> <span class='na'>extends=</span><span class='s'>&quot;struts-default&quot;</span><span class='nt'>&gt;</span>
	<span class='nt'>&lt;interceptors&gt;</span>
		<span class='nt'>&lt;interceptor</span> <span class='na'>name=</span><span class='s'>&quot;loginInterceptor&quot;</span> <span class='na'>class=</span><span class='s'>&quot;com.kaishengit.web.interceptor.LoginInteceptor&quot;</span><span class='nt'>/&gt;</span>
	<span class='nt'>&lt;/interceptors&gt;</span>
		...
<span class='nt'>&lt;/package&gt;</span>
</code></pre>
</div>
<h3 id='id2'>拦截器使用</h3>

<ul>
<li>在指定的Action中使用</li>
</ul>
<div class='highlight'><pre><code class='xml'><span class='nt'>&lt;action</span> <span class='na'>name=</span><span class='s'>&quot;login&quot;</span> <span class='na'>class=</span><span class='s'>&quot;com.kaishengit.web.LoginAction&quot;</span> <span class='na'>method=</span><span class='s'>&quot;login&quot;</span><span class='nt'>&gt;</span>
	<span class='nt'>&lt;result&gt;</span>suc.jsp<span class='nt'>&lt;/result&gt;</span>
	<span class='nt'>&lt;interceptor-ref</span> <span class='na'>name=</span><span class='s'>&quot;loginInterceptor&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;/action&gt;</span>
</code></pre>
</div>
<p>当Action中配置拦截器后，<strong>package中</strong>默认的<strong>defaultStack</strong>拦截器栈将无法使用，所以必须在引入自定义拦截器的同时也将默认<strong>defaultStack</strong>引入到Action中，正确做法如下：</p>
<div class='highlight'><pre><code class='xml'><span class='nt'>&lt;action</span> <span class='na'>name=</span><span class='s'>&quot;login&quot;</span> <span class='na'>class=</span><span class='s'>&quot;com.kaishengit.web.LoginAction&quot;</span> <span class='na'>method=</span><span class='s'>&quot;login&quot;</span><span class='nt'>&gt;</span>
	<span class='nt'>&lt;result&gt;</span>suc.jsp<span class='nt'>&lt;/result&gt;</span>
	<span class='nt'>&lt;interceptor-ref</span> <span class='na'>name=</span><span class='s'>&quot;loginInterceptor&quot;</span><span class='nt'>/&gt;</span>
	<span class='nt'>&lt;interceptor-ref</span> <span class='na'>name=</span><span class='s'>&quot;defaultStack&quot;</span><span class='nt'>/&gt;</span>
<span class='nt'>&lt;/action&gt;</span>
</code></pre>
</div>
<ul>
<li>在package中所有的Action中去使用 在每个Action中引入拦截器是个很啰嗦的事，所以可以通过更改<strong>package</strong>默认拦截器的方式来让每个Action都应用到。</li>
</ul>
<div class='highlight'><pre><code class='xml'><span class='nt'>&lt;package</span> <span class='na'>name=</span><span class='s'>&quot;mystruts&quot;</span> <span class='na'>extends=</span><span class='s'>&quot;struts-default&quot;</span><span class='nt'>&gt;</span>
	<span class='nt'>&lt;interceptors&gt;</span>
		<span class='nt'>&lt;interceptor</span> <span class='na'>name=</span><span class='s'>&quot;loginInterceptor&quot;</span> <span class='na'>class=</span><span class='s'>&quot;com.kaishengit.web.interceptor.LoginInteceptor&quot;</span><span class='nt'>/&gt;</span>
		<span class='nt'>&lt;interceptor-stack</span> <span class='na'>name=</span><span class='s'>&quot;mystrack&quot;</span><span class='nt'>&gt;</span>
			<span class='nt'>&lt;interceptor-ref</span> <span class='na'>name=</span><span class='s'>&quot;loginInterceptor&quot;</span><span class='nt'>/&gt;</span>
			<span class='nt'>&lt;interceptor-ref</span> <span class='na'>name=</span><span class='s'>&quot;defaultStrack&quot;</span><span class='nt'>/&gt;</span>
		<span class='nt'>&lt;/interceptor-stack&gt;</span>
	<span class='nt'>&lt;/interceptors&gt;</span>
	<span class='nt'>&lt;default-interceptor-ref</span> <span class='na'>name=</span><span class='s'>&quot;mystrack&quot;</span><span class='nt'>/&gt;</span>
	…
<span class='nt'>&lt;/package&gt;</span>
</code></pre>
</div>
<h3 id='id3'>拦截器实例</h3>

<h5 id='timer'>自定义Timer拦截器</h5>
<div class='highlight'><pre><code class='java'><span class='kd'>public</span> <span class='kd'>class</span> <span class='nc'>MyTimerInterceptor</span> <span class='kd'>extends</span> <span class='n'>AbstractInterceptor</span><span class='o'>{</span>

	<span class='kd'>private</span> <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>long</span> <span class='n'>serialVersionUID</span> <span class='o'>=</span> <span class='mi'>1L</span><span class='o'>;</span>

	<span class='nd'>@Override</span>
	<span class='kd'>public</span> <span class='n'>String</span> <span class='nf'>intercept</span><span class='o'>(</span><span class='n'>ActionInvocation</span> <span class='n'>invocation</span><span class='o'>)</span> <span class='kd'>throws</span> <span class='n'>Exception</span> <span class='o'>{</span>
		<span class='c1'>//获取开始时间</span>
		<span class='kt'>long</span> <span class='n'>startTime</span> <span class='o'>=</span> <span class='n'>System</span><span class='o'>.</span><span class='na'>currentTimeMillis</span><span class='o'>();</span>
		<span class='n'>String</span> <span class='n'>result</span> <span class='o'>=</span> <span class='n'>invocation</span><span class='o'>.</span><span class='na'>invoke</span><span class='o'>();</span>
		<span class='c1'>//计算耗时</span>
		<span class='kt'>long</span> <span class='n'>time</span> <span class='o'>=</span> <span class='n'>System</span><span class='o'>.</span><span class='na'>currentTimeMillis</span><span class='o'>()</span> <span class='o'>-</span> <span class='n'>startTime</span><span class='o'>;</span>
		
		<span class='c1'>//获取当前拦截的Action在struts.xml中配置的name名称</span>
		<span class='n'>String</span> <span class='n'>actionName</span> <span class='o'>=</span> <span class='n'>invocation</span><span class='o'>.</span><span class='na'>getProxy</span><span class='o'>().</span><span class='na'>getActionName</span><span class='o'>();</span>
		<span class='c1'>//获取当前拦截的Action所执行的方法</span>
		<span class='n'>String</span> <span class='n'>method</span> <span class='o'>=</span> <span class='n'>invocation</span><span class='o'>.</span><span class='na'>getProxy</span><span class='o'>().</span><span class='na'>getMethod</span><span class='o'>();</span>
		
		<span class='n'>StringBuilder</span> <span class='n'>msg</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>StringBuilder</span><span class='o'>();</span>
		<span class='n'>msg</span><span class='o'>.</span><span class='na'>append</span><span class='o'>(</span><span class='n'>actionName</span><span class='o'>).</span><span class='na'>append</span><span class='o'>(</span><span class='s'>&quot;!&quot;</span><span class='o'>)</span>
			<span class='o'>.</span><span class='na'>append</span><span class='o'>(</span><span class='n'>method</span><span class='o'>).</span><span class='na'>append</span><span class='o'>(</span><span class='s'>&quot;执行耗时：&quot;</span><span class='o'>)</span>
			<span class='o'>.</span><span class='na'>append</span><span class='o'>(</span><span class='n'>time</span><span class='o'>).</span><span class='na'>append</span><span class='o'>(</span><span class='s'>&quot;ms&quot;</span><span class='o'>);</span>
		<span class='n'>System</span><span class='o'>.</span><span class='na'>out</span><span class='o'>.</span><span class='na'>println</span><span class='o'>(</span><span class='n'>msg</span><span class='o'>);</span>
		<span class='k'>return</span> <span class='n'>result</span><span class='o'>;</span>
	<span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<h6 id='id4'>登录验证拦截器</h6>
<div class='highlight'><pre><code class='java'><span class='kd'>public</span> <span class='kd'>class</span> <span class='nc'>LoginInterceptor</span> <span class='kd'>extends</span> <span class='n'>AbstractInterceptor</span><span class='o'>{</span>

	<span class='kd'>private</span> <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>long</span> <span class='n'>serialVersionUID</span> <span class='o'>=</span> <span class='mi'>1L</span><span class='o'>;</span>

	<span class='kd'>private</span> <span class='n'>Set</span><span class='o'>&lt;</span><span class='n'>String</span><span class='o'>&gt;</span> <span class='n'>excludeActionSet</span><span class='o'>;</span>
	
	<span class='nd'>@Override</span>
	<span class='kd'>public</span> <span class='n'>String</span> <span class='nf'>intercept</span><span class='o'>(</span><span class='n'>ActionInvocation</span> <span class='n'>invocation</span><span class='o'>)</span> <span class='kd'>throws</span> <span class='n'>Exception</span> <span class='o'>{</span>
		<span class='c1'>//获取当前执行的Action的name</span>
		<span class='n'>String</span> <span class='n'>name</span> <span class='o'>=</span> <span class='n'>invocation</span><span class='o'>.</span><span class='na'>getProxy</span><span class='o'>().</span><span class='na'>getActionName</span><span class='o'>();</span>

		<span class='k'>if</span><span class='o'>(</span><span class='n'>excludeActionSet</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>name</span><span class='o'>))</span> <span class='o'>{</span>
			<span class='c1'>//如果不属于拦截的Action，直接放行</span>
			<span class='k'>return</span> <span class='n'>invocation</span><span class='o'>.</span><span class='na'>invoke</span><span class='o'>();</span>
		<span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
			<span class='c1'>//属于拦截的Action，检查Session中是否有User对象</span>
			<span class='n'>Map</span><span class='o'>&lt;</span><span class='n'>String</span><span class='o'>,</span><span class='n'>Object</span><span class='o'>&gt;</span> <span class='n'>session</span> <span class='o'>=</span> <span class='n'>invocation</span><span class='o'>.</span><span class='na'>getInvocationContext</span><span class='o'>().</span><span class='na'>getContext</span><span class='o'>().</span><span class='na'>getSession</span><span class='o'>();</span>
			<span class='n'>User</span> <span class='n'>user</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>User</span><span class='o'>)</span> <span class='n'>session</span><span class='o'>.</span><span class='na'>get</span><span class='o'>(</span><span class='s'>&quot;session_in_user&quot;</span><span class='o'>);</span>
			<span class='k'>if</span><span class='o'>(</span><span class='n'>user</span> <span class='o'>==</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
				<span class='k'>return</span> <span class='n'>Action</span><span class='o'>.</span><span class='na'>LOGIN</span><span class='o'>;</span>
			<span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
				<span class='k'>return</span> <span class='n'>invocation</span><span class='o'>.</span><span class='na'>invoke</span><span class='o'>();</span>
			<span class='o'>}</span>
		<span class='o'>}</span>
	<span class='o'>}</span>
	<span class='cm'>/**</span>
<span class='cm'>	 * 该方法由struts2自动调用，用来配置哪些Action不被该拦截器拦截</span>
<span class='cm'>	 * @param excludeActions</span>
<span class='cm'>	 */</span>
	<span class='kd'>public</span> <span class='kt'>void</span> <span class='nf'>setExcludeActions</span><span class='o'>(</span><span class='n'>String</span> <span class='n'>excludeActions</span><span class='o'>)</span> <span class='o'>{</span>
		<span class='c1'>//将一个字符串根据逗号分割，返回set集合</span>
		<span class='n'>excludeActionSet</span> <span class='o'>=</span> <span class='n'>TextParseUtil</span><span class='o'>.</span><span class='na'>commaDelimitedStringToSet</span><span class='o'>(</span><span class='n'>excludeActions</span><span class='o'>);</span>
	<span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>使用方式</p>
<div class='highlight'><pre><code class='xml'><span class='nt'>&lt;interceptors&gt;</span>
	<span class='nt'>&lt;interceptor</span> <span class='na'>name=</span><span class='s'>&quot;loginInterceptor&quot;</span> <span class='na'>class=</span><span class='s'>&quot;com.kaishengit.web.interceptor.LoginInteceptor&quot;</span><span class='nt'>/&gt;</span>
	
	<span class='nt'>&lt;interceptor-stack</span> <span class='na'>name=</span><span class='s'>&quot;mystrack&quot;</span><span class='nt'>&gt;</span>
		<span class='nt'>&lt;interceptor-ref</span> <span class='na'>name=</span><span class='s'>&quot;loginInterceptor&quot;</span><span class='nt'>&gt;</span>
			<span class='c'>&lt;!-- 配置名称为index和login的Action不被拦截 --&gt;</span>
			<span class='nt'>&lt;param</span> <span class='na'>name=</span><span class='s'>&quot;excludeActions&quot;</span><span class='nt'>&gt;</span>index,login<span class='nt'>&lt;/param&gt;</span>
		<span class='nt'>&lt;/interceptor-ref&gt;</span>
		<span class='nt'>&lt;interceptor-ref</span> <span class='na'>name=</span><span class='s'>&quot;defaultStrack&quot;</span><span class='nt'>/&gt;</span>
	<span class='nt'>&lt;/interceptor-stack&gt;</span>
<span class='nt'>&lt;/interceptors&gt;</span>
</code></pre>
</div>
<h2 id='id5'>其他</h2>

<ul>
<li>获取拦截的Action的完全限定名</li>
</ul>
<div class='highlight'><pre><code class='java'><span class='n'>invocation</span><span class='o'>.</span><span class='na'>getAction</span><span class='o'>().</span><span class='na'>getClass</span><span class='o'>().</span><span class='na'>getName</span><span class='o'>()</span><span class='err'>；</span>
</code></pre>
</div>]]></content:encoded>
    </item>
    
    <item>
      <title>Hello,World</title>
      <link href="http://fankai.me/2012/03/helloworld/"/>
      <pubDate>2012-03-17T10:52:00+08:00</pubDate>
      <author>樊凯</author>
      <guid>http://fankai.me/2012/03/helloworld</guid>
      <content:encoded><![CDATA[<p>写blog的习惯种种原因，中断了近三年的时间，这期间很多的东西都没有记录下来，当用到曾经用到的东西时发现自己都忘记了。所以这次借助github，并且依靠octopress这个hanck的blog系统，把以后的时光进行记录下来！</p>

<p>搭建这个环境时用到以下文档，感谢！<br /><a href='http://blog.4321.la/articles/2012/01/25/set-up-octopress/'>http://blog.4321.la/articles/2012/01/25/set-up-octopress/</a><br /><a href='http://markdown.tw/'>http://markdown.tw/</a><br /><a href='http://rogerdudler.github.com/git-guide/index.zh.html'>http://rogerdudler.github.com/git-guide/index.zh.html</a><br /><a href='http://www.xiaoche.me/blog/2012/01/18/install-octopress/'>http://www.xiaoche.me/blog/2012/01/18/install-octopress/</a></p>]]></content:encoded>
    </item>
    
  </channel>
</rss>
